var SubstanceCounter=function(){function n(n){console.log("SubstanceCounter.constructor",n);this.prefix="";this.Substances=[];n!=null&&n!=undefined&&(this.Etalon=n.Etalon,this.Substances=n.Substances);this.DrawTable()}return n.prototype.ClearTable=function(){document.getElementById(this.prefix+".tbodySubstances").innerHTML=""},n.prototype.DrawEtalon=function(){var n=document.createElement("tr"),t='\n                <td>\n                    <input class="form-control etalon-field" data-prefix="'+this.prefix+'" name="'+this.prefix+'.etalon.Name" type="text" value="">\n                <\/td>\n\n                <td>\n                    <input class="form-control etalon-field" data-prefix="'+this.prefix+'" name="'+this.prefix+'.etalon.Massa" type="number" value="">\n                <\/td>\n\n                <td>\n                    <input class="form-control etalon-field" data-prefix="'+this.prefix+'" name="'+this.prefix+'.etalon.MolarMassa" type="number" value="">\n                <\/td>\n\n                <td>\n                    <input class="form-control etalon-field" data-prefix="'+this.prefix+'" name="'+this.prefix+'.etalon.Koef" type="number" value="">\n                <\/td>\n\n                <td>\n\n                <\/td>';n.innerHTML=t;document.getElementById(this.prefix+".tbodySubstances").appendChild(n)},n.prototype.DrawSubstance=function(n){var t=document.createElement("tr"),i='\n                    <td>\n                        <input class="form-control substance-name" name="'+this.prefix+".Name["+n+']" data-count="'+n+'" type="text" value="">\n                    <\/td>\n\n                    <td>\n                        <input class="form-control substance-massa" name="'+this.prefix+".Massa["+n+']" data-count="'+n+'" data-prefix="'+this.prefix+'" type="number" value="">\n                    <\/td>\n\n                    <td>\n                        <input class="form-control substance-mollar-massa" data-count="'+n+'" data-prefix="'+this.prefix+'" name="'+this.prefix+".MolarMassa["+n+']" type="number" value="">\n                    <\/td>\n\n                    <td>\n                        <input class="form-control substance-koef" data-count="'+n+'" data-prefix="'+this.prefix+'" name="'+this.prefix+".Koef["+n+']" type="number" value="">\n                    <\/td>\n\n                    <td>\n                        <button class="btn btn-danger substance-remove" data-count="'+n+'" data-prefix="'+this.prefix+'">\n                            <i class="fas fa-trash" data-count="'+n+'" data-prefix="'+this.prefix+'">\n\n                            <\/i>\n                        <\/button>\n                    <\/td>';t.innerHTML=i;document.getElementById(this.prefix+".tbodySubstances").appendChild(t)},n.prototype.DrawTable=function(){this.Etalon==null&&(ToastrWorker.ShowError("Не указано эталонное вещество"),this.Etalon={Name:"",Koef:1,Massa:1,MolarMassa:1});this.DrawEtalon();this.setValueToName(this.prefix+".etalon.Name",this.Etalon.Name);this.setValueToName(this.prefix+".etalon.Massa",this.Etalon.Massa.toString());this.setValueToName(this.prefix+".etalon.MolarMassa",this.Etalon.MolarMassa.toString());this.setValueToName(this.prefix+".etalon.Koef",this.Etalon.Koef.toString());for(var n=0;n<this.Substances.length;n++)this.DrawSubstance(n),this.setValuesToSubstance(n);SubstanceEventSetter.InitHandlers()},n.prototype.AddSubstance=function(){var n=SubstanceStaticHandlers.substance.Substances.length;this.DrawSubstance(n);this.Substances.push({Koef:1,Massa:1,MolarMassa:1,Name:""})},n.prototype.RecalcSubstances=function(){for(var n=0;n<this.Substances.length;n++)SubstanceStaticHandlers.ChangeMassa(n,this.prefix)},n.prototype.setValuesToSubstance=function(n){var t=this.Substances[n];this.setValueToName(this.prefix+".Name["+n+"]",t.Name);this.setValueToName(this.prefix+".Massa["+n+"]",t.Massa!=null?t.Massa.toString():"");this.setValueToName(this.prefix+".MolarMassa["+n+"]",t.MolarMassa!=null?t.MolarMassa.toString():"");this.setValueToName(this.prefix+".Koef["+n+"]",t.Koef!=null?t.Koef.toString():"")},n.prototype.setValueToName=function(n,t){document.getElementsByName(n)[0].value=t},n.prototype.setProperties=function(){this.Etalon={Name:document.getElementsByName(this.prefix+".etalon.Name")[0].value,Massa:+document.getElementsByName(this.prefix+".etalon.Massa")[0].value,MolarMassa:+document.getElementsByName(this.prefix+".etalon.MolarMassa")[0].value,Koef:+document.getElementsByName(this.prefix+".etalon.Koef")[0].value};this.RecalcSubstances()},n.prototype.getJSON=function(){return{Etalon:this.Etalon,Substances:this.Substances}},n.prototype.getTotalKoef=function(){return this.Etalon.Massa/this.Etalon.MolarMassa/this.Etalon.Koef},n}(),SubstanceEventSetter=function(){function n(){}return n.InitHandlers=function(){EventSetter.SetHandlerForClass("substance-name","change",function(n){var t=+$(n.target).data("count");SubstanceStaticHandlers.ChangeName(t,$(n.target).val().toString())});EventSetter.SetHandlerForClass("substance-massa","change",function(n){var t=+$(n.target).data("count");SubstanceStaticHandlers.WriteMassa(+$(n.target).val(),t)});EventSetter.SetHandlerForClass("add-substance-btn","click",function(n){var t=$(n.target).data("prefix").toString();SubstanceStaticHandlers.AddSubstance(t)});EventSetter.SetHandlerForClass("substance-mollar-massa","change",function(n){var t=+$(n.target).data("count"),i=$(n.target).data("prefix").toString();SubstanceStaticHandlers.ChangeMassa(t,i)});EventSetter.SetHandlerForClass("substance-mollar-massa","input",function(n){var t=+$(n.target).data("count"),i=$(n.target).data("prefix").toString();SubstanceStaticHandlers.ChangeMassa(t,i)});EventSetter.SetHandlerForClass("substance-koef","change",function(n){var t=+$(n.target).data("count"),i=$(n.target).data("prefix").toString();SubstanceStaticHandlers.ChangeMassa(t,i)});EventSetter.SetHandlerForClass("substance-koef","input",function(n){var t=+$(n.target).data("count"),i=$(n.target).data("prefix").toString();SubstanceStaticHandlers.ChangeMassa(t,i)});EventSetter.SetHandlerForClass("substance-remove","click",function(n){var i=n.srcElement,t;console.log(".substance-remove clicked",n.target);t=+$(i).data("count");SubstanceStaticHandlers.RemoveSubstanceHandler(t)});var n=function(n){var t=$(n.target).data("prefix").toString();SubstanceStaticHandlers.EtalonChangedHandler(t)};EventSetter.SetHandlerForClass("etalon-field","change",n);EventSetter.SetHandlerForClass("etalon-field","input",n)},n}(),SubstanceStaticHandlers=function(){function n(){}return n.RemoveSubstanceHandler=function(t){var i=Object.assign(n.substance);console.log("RemoveSubstanceHandler{"+t+") BeforeRemove",i);n.substance.Substances.splice(t);console.log("RemoveSubstanceHandler AfterRemove",n.substance);n.substance.ClearTable();n.substance.DrawTable()},n.EtalonChangedHandler=function(t){t==""&&(n.substance.setProperties(),console.log(n.substance))},n.ChangeMassa=function(t,i){var u=+document.getElementsByName(i+".MolarMassa["+t+"]")[0].value,f=+document.getElementsByName(i+".Koef["+t+"]")[0].value,r=n.substance.getTotalKoef()*f*u;r=+r.toFixed(2);n.substance.Substances[t].MolarMassa=u;n.substance.Substances[t].Massa=r;n.substance.Substances[t].Koef=f;document.getElementsByName(i+".Massa["+t+"]")[0].value=r.toFixed(2)},n.WriteMassa=function(t,i){n.substance.Substances[i].Massa=t},n.ChangeName=function(t,i){console.log("SubstanceStaticHandlers.ChangeName");n.substance.Substances[t].Name=i},n.AddSubstance=function(t){t===""&&n.substance.AddSubstance()},n}();