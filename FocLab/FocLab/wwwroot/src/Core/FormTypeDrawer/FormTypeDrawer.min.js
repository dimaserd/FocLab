var CSharpType,UserInterfaceType;(function(n){n[n.String="String"]="String";n[n.Int="Int32"]="Int";n[n.Decimal="Decimal"]="Decimal";n[n.Boolean="Boolean"]="Boolean";n[n.DateTime="DateTime"]="DateTime"})(CSharpType||(CSharpType={})),function(n){n[n.TextBox="TextBox"]="TextBox";n[n.TextArea="TextArea"]="TextArea";n[n.DropDownList="DropDownList"]="DropDownList";n[n.Hidden="Hidden"]="Hidden";n[n.DatePicker="DatePicker"]="DatePicker";n[n.MultipleDropDownList="MultipleDropDownList"]="MultipleDropDownList"}(UserInterfaceType||(UserInterfaceType={}));var FormDrawImplementation=function(){function n(n){this._datePickerPropNames=[];this._selectClass="form-draw-select";this._model=n}return n.prototype.BeforeFormDrawing=function(){},n.prototype.AfterFormDrawing=function(){var t,i,r;for($("."+this._selectClass).selectpicker("refresh"),t=0;t<this._datePickerPropNames.length;t++)i=this._datePickerPropNames[t],r=""+this._model.Prefix+i,n.InitCalendarForPrefixedProperty(r)},n.InitCalendarForPrefixedProperty=function(n){Utils.SetDatePicker("input[name='"+n+"']")},n.prototype.RenderDatePicker=function(n,t){return this._datePickerPropNames.push(n.PropertyName),this.RenderTextBox(n,t)},n.prototype.RenderHidden=function(n,t){var r=ValueProviderHelper.GetStringValueFromValueProvider(n,this._model.ValueProvider),i='<input type="hidden" name="'+FormDrawHelper.GetPropertyValueName(n.PropertyName,this._model.Prefix)+'" value="'+r+'">';return t?this.WrapInForm(n,i):i},n.prototype.RenderTextBox=function(n,t){var r=ValueProviderHelper.GetStringValueFromValueProvider(n,this._model.ValueProvider),i='<label for="'+n.PropertyName+'">'+n.PropertyDisplayName+'<\/label>\n                <input autocomplete="false" class="form-control m-input" name="'+FormDrawHelper.GetPropertyValueName(n.PropertyName,this._model.Prefix)+'" type="text" value="'+r+'">';return t?this.WrapInForm(n,i):i},n.prototype.RenderTextArea=function(n,t){var r=ValueProviderHelper.GetStringValueFromValueProvider(n,this._model.ValueProvider),i='<label for="'+n.PropertyName+'">'+n.PropertyDisplayName+'<\/label>\n            <textarea autocomplete="false" class="form-control m-input" name="'+FormDrawHelper.GetPropertyValueName(n.PropertyName,this._model.Prefix)+'" rows="3" style="margin-top: 0px; margin-bottom: 0px; height: 79px;">'+r+"<\/textarea>";return t?this.WrapInForm(n,i):i},n.prototype.RenderGenericDropList=function(n,t,i,r){var f=ValueProviderHelper.GetRawValueFromValueProvider(n,this._model.ValueProvider);t=HtmlDrawHelper.ProceesSelectValues(n,f,t);var e=this._selectClass+" form-control m-input m-bootstrap-select m_selectpicker",o=i?new Dictionary([{key:"multiple",value:""}]):null,s=HtmlDrawHelper.RenderSelect(e,FormDrawHelper.GetPropertyValueName(n.PropertyName,this._model.Prefix),t,o),u='<label for="'+n.PropertyName+'">'+n.PropertyDisplayName+"<\/label>"+s;return r?this.WrapInForm(n,u):u},n.prototype.WrapInForm=function(n,t){return'<div class="form-group m-form__group" '+FormDrawHelper.GetOuterFormAttributes(n.PropertyName,this._model.Prefix)+">\n                    "+t+"\n                <\/div>"},n.prototype.RenderDropDownList=function(n,t,i){return this.RenderGenericDropList(n,t,!1,i)},n.prototype.RenderMultipleDropDownList=function(n,t,i){return this.RenderGenericDropList(n,t,!0,i)},n}(),TabFormDrawImplementation=function(){function n(n){this._datePickerPropNames=[];this._selectClass="form-draw-select";this._model=n}return n.prototype.BeforeFormDrawing=function(){},n.prototype.AfterFormDrawing=function(){var n,t,i;for($("."+this._selectClass).selectpicker("refresh"),n=0;n<this._datePickerPropNames.length;n++)t=this._datePickerPropNames[n],i=""+this._model.Prefix+t,FormDrawImplementation.InitCalendarForPrefixedProperty(i)},n.prototype.RenderTextBox=function(n){var t=ValueProviderHelper.GetStringValueFromValueProvider(n,this._model.ValueProvider);return'<div class="form-group m-form__group row">\n                    <label class="col-xl-3 col-lg-3 col-form-label">\n                        '+n.PropertyDisplayName+':\n                    <\/label>\n                    <div class="col-xl-9 col-lg-9">\n                        <div class="input-group">\n                            <input type="text" name="'+this.GetPropertyValueName(n.PropertyName)+'" class="form-control m-input" placeholder="" value="'+t+'">\n                        <\/div>\n                    <\/div>\n                <\/div>'},n.prototype.RenderTextArea=function(n){var t=ValueProviderHelper.GetStringValueFromValueProvider(n,this._model.ValueProvider);return'<div class="form-group m-form__group row">\n                    <label class="col-xl-3 col-lg-3 col-form-label">'+n.PropertyDisplayName+'<\/label>\n                    <div class="col-xl-9 col-lg-9">\n                        <textarea class="form-control m-input" name="'+this.GetPropertyValueName(n.PropertyName)+'" rows="3">'+t+"<\/textarea>\n                    <\/div>\n\n                <\/div>"},n.prototype.RenderGenericDropList=function(n,t,i){var r=ValueProviderHelper.GetRawValueFromValueProvider(n,this._model.ValueProvider);t=HtmlDrawHelper.ProceesSelectValues(n,r,t);var u=this._selectClass+" form-control m-input m-bootstrap-select m_selectpicker",f=i?new Dictionary([{key:"multiple",value:""}]):null,e=HtmlDrawHelper.RenderSelect(u,this.GetPropertyValueName(n.PropertyName),t,f);return'<div class="form-group m-form__group row">\n                    <label class="col-xl-3 col-lg-3 col-form-label">'+n.PropertyDisplayName+':<\/label>\n                    <div class="col-xl-9 col-lg-9">\n                        '+e+"\n                    <\/div>\n                <\/div>"},n.prototype.RenderDropDownList=function(n,t){return this.RenderGenericDropList(n,t,!1)},n.prototype.RenderMultipleDropDownList=function(n,t){return this.RenderGenericDropList(n,t,!0)},n.prototype.RenderHidden=function(n){var t=ValueProviderHelper.GetStringValueFromValueProvider(n,this._model.ValueProvider);return'<input type="hidden" name="'+this.GetPropertyValueName(n.PropertyName)+'" value="'+t+'">'},n.prototype.RenderDatePicker=function(n){return this._datePickerPropNames.push(n.PropertyName),this.RenderTextBox(n)},n.prototype.GetPropertyValueName=function(n){return""+this._model.Prefix+n},n}(),FormDrawFactory=function(){function n(){}return n.GetImplementation=function(t,i){var r=n.DictionaryImplementations.getByKey(i);return r==null?new FormDrawImplementation(t):r(t)},n.DictionaryImplementations=new Dictionary([{key:"Default",value:function(n){return new FormDrawImplementation(n)}},{key:"Tab",value:function(n){return new TabFormDrawImplementation(n)}}]),n}(),FormDrawHelper=function(){function n(){}return n.GetPropertyValueName=function(n,t){return""+t+n},n.GetPropertySelector=function(t,i){var r=n.GetPropertyValueName(t,i);return"input[name='"+r+"']"},n.GetOuterFormElement=function(t,i){return document.querySelector("["+n.FormPropertyName+'="'+t+'"]['+n.FormModelPrefix+'="'+i+'"]')},n.GetOuterFormAttributes=function(t,i){return n.FormPropertyName+'="'+t+'" '+n.FormModelPrefix+'="'+i+'"'},n.FormPropertyName="form-property-name",n.FormModelPrefix="form-model-prefix",n}(),HtmlDrawHelper=function(){function n(){}return n.RenderAttributesString=function(n){var u="",t,i,r;if(n==null)return u;for(t=0;t<n._keys.length;t++)i=n._keys[t],r=n.getByKey(i),u+=r==null||r===""?" "+i:" "+i+'="'+r+'"';return u},n.RenderSelect=function(t,i,r,u){var s=n.RenderAttributesString(u),o,f,e,h;for(console.log("RenderSelect",s),o="<select"+s+' class="'+t+'" name="'+i+'">',f=0;f<r.length;f++)e=r[f],h=e.Selected?' selected="selected"':"",o+="<option"+h+' value="'+e.Value+'">'+e.Text+"<\/option>";return o+"<\/select>"},n.ProceesSelectValues=function(n,t,i){if(t!=null){i.forEach(function(n){return n.Selected=!1});var r=n.TypeName==CSharpType.Boolean.toString()?i.find(function(n){return n.Value.toLowerCase()==t.toLowerCase()}):i.find(function(n){return n.Value==t});r!=null&&(r.Selected=!0)}return i},n}(),ValueProviderHelper=function(){function n(){}return n.GetStringValueFromValueProvider=function(t,i){var r=n.GetRawValueFromValueProvider(t,i);return r==null?"":r},n.GetRawValueFromValueProvider=function(n,t){if(t==null)return null;if(!n.IsEnumerable){var i=t.Singles.find(function(t){return t.PropertyName==n.PropertyName});return i==null?null:i.Value}return""},n}(),FormTypeAfterDrawnDrawer=function(){function n(){}return n.SetInnerHtmlForProperty=function(n,t,i){var r=FormDrawHelper.GetOuterFormElement(n,t);console.log("SetInnerHtmlForProperty elem",r);r.innerHTML=i},n.SetSelectListForProperty=function(t,i,r){var u=TryForm._genericInterfaces.find(function(n){return n.Prefix===i}),f=u.TypeDescription.Properties.find(function(n){return n.PropertyName===t}),e=new FormDrawImplementation(u),o=e.RenderDropDownList(f,r,!1);n.SetInnerHtmlForProperty(f.PropertyName,i,o);e.AfterFormDrawing()},n}(),FormTypeDataGetter=function(){function n(n){if(!n.IsClass){var t="Тип не являющийся классом не поддерживается";alert(t);throw Error(t);}this._typeDescription=n}return n.prototype.BuildObject=function(){for(var i,t={},n=0;n<this._typeDescription.Properties.length;n++)i=this._typeDescription.Properties[n],t[i.PropertyName]="";return t},n.prototype.GetData=function(n){for(var t,i=FormDataHelper.CollectDataByPrefix(this.BuildObject(),n),r=0;r<this._typeDescription.Properties.length;r++){t=this._typeDescription.Properties[r];switch(t.TypeName){case CSharpType.Decimal.toString():i[t.PropertyName]=Number(i[t.PropertyName].replace(/,/g,"."));break;case CSharpType.Boolean.toString():i[t.PropertyName]=i[t.PropertyName].toLowerCase()==="true"}}return i},n}(),FormTypeDrawer=function(){function n(n,t){this._formDrawer=n;this._typeDescription=t}return n.prototype.BeforeFormDrawing=function(){this._formDrawer.BeforeFormDrawing()},n.prototype.AfterFormDrawing=function(){this._formDrawer.AfterFormDrawing()},n.prototype.TextBoxFor=function(t,i){var r=n.FindPropByName(this._typeDescription,t);return this._formDrawer.RenderTextBox(r,i)},n.prototype.DatePickerFor=function(t,i){var r=n.FindPropByName(this._typeDescription,t);return this._formDrawer.RenderDatePicker(r,i)},n.prototype.TextAreaFor=function(t,i){var r=n.FindPropByName(this._typeDescription,t);return this._formDrawer.RenderTextArea(r,i)},n.prototype.DropDownFor=function(t,i,r){var u=n.FindPropByName(this._typeDescription,t);return this._formDrawer.RenderDropDownList(u,i,r)},n.prototype.MultipleDropDownFor=function(t,i,r){var u=n.FindPropByName(this._typeDescription,t);return this._formDrawer.RenderMultipleDropDownList(u,i,r)},n.prototype.HiddenFor=function(t,i){var r=n.FindPropByName(this._typeDescription,t);return this._formDrawer.RenderHidden(r,i)},n.FindPropByName=function(n,t){for(var r,i=0;i<n.Properties.length;i++)if(r=n.Properties[i],r.PropertyName==t)return r;throw new Error("Свойство "+t+" не найдено");},n}(),FormTypeDrawerModelBuilder=function(){function n(n){this._model=n}return n.prototype.SetMultipleDropDownListFor=function(n,t){var i=this.GetPropertyBlockByName(n);return i.InterfaceType=UserInterfaceType.MultipleDropDownList,i.SelectList=t,this.ResetBlock(i),this},n.prototype.SetDropDownListFor=function(n,t){var i=this.GetPropertyBlockByName(n);return i.InterfaceType=UserInterfaceType.DropDownList,i.SelectList=t,this.ResetBlock(i),this},n.prototype.SetTextAreaFor=function(n){var t=this.GetPropertyBlockByName(n);if(t.InterfaceType!=UserInterfaceType.TextBox)throw new Error("Только элементы с типом "+UserInterfaceType.TextBox+" можно переключать на "+UserInterfaceType.TextArea);return t.InterfaceType=UserInterfaceType.TextArea,this.ResetBlock(t),this},n.prototype.SetHiddenFor=function(n){var t=this.GetPropertyBlockByName(n);return t.InterfaceType=UserInterfaceType.Hidden,this.ResetBlock(t),this},n.prototype.ResetBlock=function(n){var t=this._model.Blocks.findIndex(function(t){return t.PropertyName==n.PropertyName});this._model.Blocks[t]=n},n.prototype.GetPropertyBlockByName=function(n){var t=this._model.Blocks.find(function(t){return t.PropertyName==n});if(t==null)throw new Error("Блок не найден по указанному имени "+n);return t},n}(),TryForm=function(){function n(){}return n.UnWrapModel=function(n,t){for(var i,r="",u=0;u<n.Blocks.length;u++){i=n.Blocks[u];switch(i.InterfaceType){case UserInterfaceType.TextBox:r+=t.TextBoxFor(i.PropertyName,!0);break;case UserInterfaceType.TextArea:r+=t.TextAreaFor(i.PropertyName,!0);break;case UserInterfaceType.DropDownList:r+=t.DropDownFor(i.PropertyName,i.SelectList,!0);break;case UserInterfaceType.Hidden:r+=t.HiddenFor(i.PropertyName,!0);break;case UserInterfaceType.DatePicker:r+=t.DatePickerFor(i.PropertyName,!0);break;case UserInterfaceType.MultipleDropDownList:r+=t.MultipleDropDownFor(i.PropertyName,i.SelectList,!0);break;default:console.log("Данный блок не реализован",i);throw new Error("Не реализовано");}}return r},n.ThrowError=function(n){alert(n);throw Error(n);},n.SetBeforeDrawingHandler=function(t,i){n._beforeDrawInterfaceHandlers.add(t,i)},n.SetAfterDrawingHandler=function(t,i){n._afterDrawInterfaceHandlers.add(t,i)},n.GetForms=function(){for(var r,i=document.getElementsByClassName("generic-user-interface"),t=0;t<i.length;t++)r=i[t],n.GetForm(r)},n.GetDataForFormByModelPrefix=function(t){var i=n._genericInterfaces.find(function(n){return n.Prefix===t});if(i==null)throw new Error("Generic user interface model is not defined by prefix '"+t+"'");return n.GetDataForForm(i)},n.GetDataForFirstForm=function(){n._genericInterfaces.length===0&&n.ThrowError("На странице не объявлено ни одной формы");var t=n._genericInterfaces[0];return n.GetDataForForm(t)},n.GetDataForForm=function(n){var t=new FormTypeDataGetter(n.TypeDescription);return t.GetData(n.Prefix)},n.AddBuildModel=function(t){var i=n._genericInterfaces.find(function(n){return n.Prefix==t.Prefix});i!=null&&n.ThrowError("На странице уже объявлена форма с префиксом "+t.Prefix);n._genericInterfaces.push(t)},n.GetForm=function(t){var s=t.getAttribute("data-id"),r=t.getAttribute("data-form-draw"),i=window[s],f,e,u,o;n._beforeDrawInterfaceHandlers.containsKey(r)&&(f=n._beforeDrawInterfaceHandlers.getByKey(r),i=f(i));n.AddBuildModel(i);e=FormDrawFactory.GetImplementation(i,r);u=new FormTypeDrawer(e,i.TypeDescription);u.BeforeFormDrawing();t.innerHTML=n.UnWrapModel(i,u);u.AfterFormDrawing();n._afterDrawInterfaceHandlers.containsKey(r)&&(o=n._afterDrawInterfaceHandlers.getByKey(r),o(i))},n._genericInterfaces=[],n._beforeDrawInterfaceHandlers=new Dictionary,n._afterDrawInterfaceHandlers=new Dictionary,n}();TryForm.GetForms();