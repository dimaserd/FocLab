@using Microsoft.AspNetCore.Html
@model List<FocLab.Model.Entities.Chemistry.ChemistryTaskExperiment>
@{
    Layout = ChemistrySettings.LayoutPath;
    ViewBag.Title = "Список экспериментов";
}

<div class="row">
    <div class="col-md-12">
        <a href="/Chemistry/Experiments/All" class="btn btn-primary">
            <i class="fa fa-list-ol"></i>
            Показать все эксперименты
        </a>
    </div>
</div>

<div style="height:20px">

</div>

<h2>
    Ваши эксперименты
</h2>

<div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>
                    <strong>Задача</strong>
                </th>

                <th>
                    <strong>Дата создания</strong>
                </th>

                <th>
                    <strong>Дата завершения</strong>
                </th>

                <th>
                    <strong>Действия</strong>
                </th>
            </tr>
        </thead>

        <tbody>
            @foreach (var experiment in Model)
            {
                var _class = experiment.Deleted ? "danger" : "";

                <tr class="@_class">
                    <td>
                        <a href="/Chemistry/Experiments/Experiment/@experiment.Id">
                            @experiment.ChemistryTask.Title
                        </a>
                    </td>

                    <td>
                        @experiment.CreationDate
                    </td>

                    <td>
                        @if(experiment.PerformedDate.HasValue)
                        {
                            @experiment.PerformedDate.Value
                        }
                        else
                        {
                            @(new HtmlString("[Не выполнен]"))
                        }
                    </td>

                    <td>
                        <div class="row">
                            <div class="col-md-12">

                                @if (!experiment.PerformedDate.HasValue)
                                {
                                    <a class="btn btn-block btn-primary" onclick="PerformExperiment('@experiment.Id', true)">
                                        <i class="fa fa-anchor"></i>
                                        Эксперимент выполнен
                                    </a>
                                }
                                else
                                {
                                    <a class="btn btn-block btn-primary" onclick="PerformExperiment('@experiment.Id', false)">
                                        <i class="fa fa-ban"></i>
                                        Отменить выполнение
                                    </a>
                                }


                                @if (experiment.Deleted)
                                {
                                    <a class="btn btn-block btn-warning" style="margin-top:10px" onclick="CancelRemovingExperiment('@experiment.Id')">
                                        <i class="fa fa-trash"></i>
                                        Отменить удаление
                                    </a>
                                }
                                else
                                {
                                    <a class="btn btn-block btn-danger" style="margin-top:10px" onclick="RemoveExperiment('@experiment.Id')">
                                        <i class="fa fa-trash"></i>
                                        Удалить
                                    </a>
                                }



                            </div>
                        </div>
                    </td>
                </tr>
            }

            @if (Model.Count == 0)
            {
                <tr>
                    <th colspan="4">
                        <button class="btn btn-success btn-block">
                            <strong>
                                У вас нет экспериментов
                            </strong>
                        </button>
                    </th>
                </tr>
            }
        </tbody>
    </table>
</div>


@section Scripts{
    <script>
        function PerformExperiment(id, flag) {

            $.ajax({
                url: '/Chemistry/Experiments/Perform',
                type: 'POST',
                data: { ExperimentId: id, Performed: flag  },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (response) {
                    console.log(response);

                    alert(response.Message);

                    location.reload();
                }
            });
        }

        function RemoveExperiment(id) {

            $.ajax({
                url: '/Chemistry/Chemistry/RemoveExperiment',
                type: 'POST',
                data: { id: id },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (response) {
                    console.log(response);

                    alert(response.Message);

                    location.reload();
                }
            });
        }

        function CancelRemovingExperiment(id) {
            $.ajax({
                url: '/Chemistry/Chemistry/CancelRemovingExperiment',
                type: 'POST',
                data: { id: id },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (response) {
                    console.log(response);

                    alert(response.Message);

                    location.reload();
                }
            });
        }
    </script>
}