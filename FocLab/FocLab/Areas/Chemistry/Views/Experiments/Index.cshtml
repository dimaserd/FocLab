@using Microsoft.AspNetCore.Html
@model List<FocLab.Logic.Models.Experiments.ChemistryTaskExperimentModel>
@{
    Layout = ChemistrySettings.LayoutPath;
    ViewBag.Title = "Список экспериментов";
}

<div class="row">
    <div class="col-md-12">
        <a href="/Chemistry/Experiments/All" class="btn btn-primary">
            <i class="fa fa-list-ol"></i>
            Показать все эксперименты
        </a>
    </div>
</div>

<div style="height:20px">

</div>

<h2>
    Ваши незавершенные эксперименты <span class="m-badge m-badge--success">@Model.Count(x => !x.PerformedDate.HasValue)</span>
</h2>

<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>
                    <strong>Задача</strong>
                </th>

                <th>
                    <strong>Дата создания</strong>
                </th>


                <th>
                    <strong>Действия</strong>
                </th>
            </tr>
        </thead>

        <tbody>
            @foreach (var experiment in Model.Where(x => !x.PerformedDate.HasValue))
            {
                
                <tr>
                    <td>
                        <a href="/Chemistry/Experiments/Experiment/@experiment.Id">
                            @experiment.Task.Title
                        </a>
                    </td>

                    <td>
                        @experiment.CreationDate
                    </td>

                    <td>
                        <div class="row">
                            <div class="col-md-12">


                                <a class="btn btn-block btn-primary" href="#" onclick="PerformExperiment('@experiment.Id', true)">
                                    <i class="fa fa-anchor"></i>
                                    Выполнить
                                </a>


                                @if (experiment.Deleted)
                                {
                                    <a class="btn btn-block btn-warning" href="#" style="margin-top:10px" onclick="CancelRemovingExperiment('@experiment.Id')">
                                        <i class="fa fa-trash"></i>
                                        Отменить удаление
                                    </a>
                                }
                                else
                                {
                                    <a class="btn btn-block btn-danger" href="#" style="margin-top:10px" onclick="RemoveExperiment('@experiment.Id')">
                                        <i class="fa fa-trash"></i>
                                        Удалить
                                    </a>
                                }
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div style="height:40px">

</div>

<h2>
    Ваши завершенные эксперименты <span class="m-badge m-badge--success">@Model.Count(x => x.PerformedDate.HasValue)</span>
</h2>

<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>
                    <strong>Задача</strong>
                </th>

                <th>
                    <strong>Дата создания</strong>
                </th>

                <th>
                    <strong>Дата выполнения</strong>
                </th>

                <th>
                    <strong>Действия</strong>
                </th>
            </tr>
        </thead>

        <tbody>
            @foreach (var experiment in Model.Where(x => x.PerformedDate.HasValue))
            {
                
                <tr>
                    <td>
                        <a href="/Chemistry/Experiments/Experiment/@experiment.Id">
                            @experiment.Task.Title
                        </a>
                    </td>

                    <td>
                        @experiment.CreationDate
                    </td>

                    <td>
                        @experiment.PerformedDate.Value
                    </td>

                    <td>
                        <div class="row">
                            <div class="col-md-12">


                                <a class="btn btn-block btn-primary" href="#" onclick="PerformExperiment('@experiment.Id', true)">
                                    <i class="fa fa-anchor"></i>
                                    Выполнить
                                </a>


                                @if (experiment.Deleted)
                                {
                                    <a class="btn btn-block btn-warning" href="#" style="margin-top:10px" onclick="CancelRemovingExperiment('@experiment.Id')">
                                        <i class="fa fa-trash"></i>
                                        Отменить удаление
                                    </a>
                                }
                                else
                                {
                                    <a class="btn btn-block btn-danger" href="#" style="margin-top:10px" onclick="RemoveExperiment('@experiment.Id')">
                                        <i class="fa fa-trash"></i>
                                        Удалить
                                    </a>
                                }
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts{
    <script>
        function PerformExperiment(id, flag) {

            $.ajax({
                url: '/Chemistry/Experiments/Perform',
                type: 'POST',
                data: { ExperimentId: id, Performed: flag },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (response) {
                    console.log(response);

                    alert(response.Message);

                    location.reload();
                }
            });
        }

        function RemoveExperiment(id) {

            $.ajax({
                url: '/Chemistry/Chemistry/RemoveExperiment',
                type: 'POST',
                data: { id: id },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (response) {
                    console.log(response);

                    alert(response.Message);

                    location.reload();
                }
            });
        }

        function CancelRemovingExperiment(id) {
            $.ajax({
                url: '/Chemistry/Chemistry/CancelRemovingExperiment',
                type: 'POST',
                data: { id: id },
                async: true,
                cache: false,
                dataType: 'json',
                success: function (response) {
                    console.log(response);

                    alert(response.Message);

                    location.reload();
                }
            });
        }
    </script>
}