@{
    Layout = ChemistrySettings.LayoutPath;
    ViewData["Title"] = "Кодогенерация";
}

<h2>Кодогенерация</h2>

<div class="m-portlet__body">
    <div class="row">
        <div class="col-xl-12">
            <div class="m-form__section m-form__section--first">
                <div class="form-group m-form__group row">
                    <label class="col-xl-3 col-lg-3 col-form-label">Тип данных:</label>
                    <div class="col-xl-9 col-lg-9">
                        <div class="input-group">

                            <input type="text" id="Search.TypeName" name="Search.TypeName" class="form-control m-input" placeholder="" value="">
                        </div>
                    </div>
                </div>
                
                <div class="form-group m-form__group row">
                    <textarea id="someValue" rows="3" class="form-control m-input" autocomplete="false"  style="margin-top: 0; margin-bottom: 0; height: 79px;">

                    </textarea>
                </div>

                <div class="m-portlet__foot m-portlet__foot--fit">
                    <div class="m-form__actions m-form__actions">
                        <div class="row">
                            <div class="col-lg-9">
                                <button type="reset" class="btn btn-brand" onclick="SearchType()" >Поиск</button>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>



@section Scripts{

    <script src="~/src/System/Types/Dictionary.js"></script>
    <script src="~/src/TSGen/TSClassGenerator.js"></script>

    <script>
        var url_string = window.location.href;
        var url = new URL(url_string);
        var type = url.searchParams.get("type");

        document.getElementById("Search.TypeName").value = type;

        function Init() {
            Requester.SendAjaxPost("/Api/Documentation/Class",
                { typeName: type },
                x => {
                    console.log(x);
                    MakeType(x);
                });
        }

        function SearchType() {
            const type = document.getElementById("Search.TypeName").value;

            location.href = `/Admin/Documentation/CodeGen?type=${type}`;
        }

        function MakeType(type) {
            const gen = new TSClassGenerator(type);

            const res = gen.GenerateClassesForType(type);

            console.log(res);

            const txtArea = document.getElementById("someValue");

            txtArea.value = res;
        }


        Init();
    </script>


}