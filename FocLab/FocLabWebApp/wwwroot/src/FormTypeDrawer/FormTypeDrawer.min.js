var UserInterfaceType;(function(n){n[n.CustomInput="CustomInput"]="CustomInput";n[n.TextBox="TextBox"]="TextBox";n[n.TextArea="TextArea"]="TextArea";n[n.DropDownList="DropDownList"]="DropDownList";n[n.Hidden="Hidden"]="Hidden";n[n.DatePicker="DatePicker"]="DatePicker";n[n.MultipleDropDownList="MultipleDropDownList"]="MultipleDropDownList"})(UserInterfaceType||(UserInterfaceType={}));var FormDrawFactory=function(){function n(n){this._defaultImplementation=n.DefaultImplementation;this._implementations=n.Implementations}return n.prototype.GetImplementation=function(n,t){var i=this._implementations.get(t);return i==null?this._defaultImplementation(n):i(n)},n}(),FormDrawHelper=function(){function n(){}return n.GetPropertyValueName=function(n,t){return""+t+n},n.GetOuterFormElement=function(t,i){return document.querySelector("["+n.FormPropertyName+'="'+t+'"]['+n.FormModelPrefix+'="'+i+'"]')},n.GetOuterFormAttributes=function(t,i){return n.FormPropertyName+'="'+t+'" '+n.FormModelPrefix+'="'+i+'"'},n.GetInputTypeHidden=function(n,t,i){i===void 0&&(i=null);var r=i!=null?i:new Map;return r.set("value",t),r.set("name",n),HtmlDrawHelper.RenderInput("hidden",r)},n.FormPropertyName="form-property-name",n.FormModelPrefix="form-model-prefix",n}(),HtmlDrawHelper=function(){function n(){}return n.RenderInput=function(t,i){var r=n.RenderAttributesString(i);return"<input type="+t+" "+r+"/>"},n.RenderAttributesString=function(n){var u="",t,f,i,r;if(n==null)return u;for(t=0,f=Array.from(n.keys());t<f.length;t++)i=f[t],r=n.get(i),u+=r==null||r===""?" "+i:" "+i+'="'+r+'"';return u},n.RenderSelect=function(t,i,r,u){for(var f,s,h=n.RenderAttributesString(u),o="<select"+h+' class="'+t+'" name="'+i+'">',e=0;e<r.length;e++)f=r[e],s=f.Selected?' selected="selected"':"",o+="<option"+s+' value="'+f.Value+'">'+f.Text+"<\/option>";return o+"<\/select>"},n}(),HtmlSelectDrawHelper=function(){function n(n){this.NullValue=n}return n.prototype.ProccessSelectValues=function(n,t,i){var u=this,r;i.forEach(function(n){n.Value==null&&(n.Value=u.NullValue)});t!=null&&(i.forEach(function(n){return n.Selected=!1}),r=n.TypeName==CSharpType.Boolean.toString()?i.find(function(n){return n.Value.toLowerCase()==t.toLowerCase()}):i.find(function(n){return n.Value==t}),r!=null&&(r.Selected=!0))},n}(),ValueProviderHelper=function(){function n(){}return n.GetStringValueFromValueProvider=function(t,i){var r=n.GetRawValueFromValueProvider(t,i);return r==null?"":r},n.GetRawValueFromValueProvider=function(n,t){if(t==null)return null;if(!n.IsEnumerable){var i=t.Singles.find(function(t){return t.PropertyName==n.PropertyDescription.PropertyName});return i==null?null:i.Value}return""},n}(),CrocoTypeDescriptionOverrider=function(){function n(){}return n.FindUserInterfacePropBlockByPropertyName=function(n,t){var i=n.Blocks.find(function(n){return n.PropertyName===t});if(i==null){alert("Свойство '"+t+"' не найдено в модели обобщенного пользоватлеьского интерфейса");return}return i},n.SetUserInterfaceTypeForProperty=function(t,i,r){var u=n.FindUserInterfacePropBlockByPropertyName(t,i);u.InterfaceType=r},n.RemoveProperty=function(n,t){n.Blocks=n.Blocks.filter(function(n){return n.PropertyName!==t})},n.SetLabelText=function(t,i,r){n.FindUserInterfacePropBlockByPropertyName(t,i).LabelText=r},n.SetHidden=function(t,i){n.SetUserInterfaceTypeForProperty(t,i,UserInterfaceType.Hidden)},n.SetTextArea=function(t,i){n.SetUserInterfaceTypeForProperty(t,i,UserInterfaceType.TextArea)},n.SetDropDownList=function(t,i,r){var u=n.FindUserInterfacePropBlockByPropertyName(t,i);u.InterfaceType=UserInterfaceType.DropDownList;u.SelectList=r},n}(),FormTypeAfterDrawnDrawer=function(){function n(){}return n.SetInnerHtmlForProperty=function(n,t,i){var r=FormDrawHelper.GetOuterFormElement(n,t);console.log("SetInnerHtmlForProperty elem",r);r.innerHTML=i},n}(),FormTypeDrawer=function(){function n(n,t){this._formDrawer=n;this._typeDescription=t}return n.prototype.BeforeFormDrawing=function(){this._formDrawer.BeforeFormDrawing()},n.prototype.AfterFormDrawing=function(){this._formDrawer.AfterFormDrawing()},n.prototype.TextBoxFor=function(n,t){var i=PropertyFormTypeSearcher.FindPropByName(this._typeDescription,n);return this._formDrawer.RenderTextBox(i,t)},n.prototype.DatePickerFor=function(n,t){var i=PropertyFormTypeSearcher.FindPropByName(this._typeDescription,n);return this._formDrawer.RenderDatePicker(i,t)},n.prototype.TextAreaFor=function(n,t){var i=PropertyFormTypeSearcher.FindPropByName(this._typeDescription,n);return this._formDrawer.RenderTextArea(i,t)},n.prototype.DropDownFor=function(n,t,i){var r=PropertyFormTypeSearcher.FindPropByName(this._typeDescription,n);return this._formDrawer.RenderDropDownList(r,t,i)},n.prototype.MultipleDropDownFor=function(n,t,i){var r=PropertyFormTypeSearcher.FindPropByName(this._typeDescription,n);return this._formDrawer.RenderMultipleDropDownList(r,t,i)},n.prototype.HiddenFor=function(n,t){var i=PropertyFormTypeSearcher.FindPropByName(this._typeDescription,n);return this._formDrawer.RenderHidden(i,t)},n}(),FormTypeDrawerModelBuilder=function(){function n(n){this._model=n}return n.prototype.SetMultipleDropDownListFor=function(n,t){var i=this.GetPropertyBlockByName(n);return i.InterfaceType=UserInterfaceType.MultipleDropDownList,i.SelectList=t,this.ResetBlock(i),this},n.prototype.SetDropDownListFor=function(n,t){var i=this.GetPropertyBlockByName(n);return i.InterfaceType=UserInterfaceType.DropDownList,i.SelectList=t,this.ResetBlock(i),this},n.prototype.SetTextAreaFor=function(n){var t=this.GetPropertyBlockByName(n);if(t.InterfaceType!=UserInterfaceType.TextBox)throw new Error("Только элементы с типом "+UserInterfaceType.TextBox+" можно переключать на "+UserInterfaceType.TextArea);return t.InterfaceType=UserInterfaceType.TextArea,this.ResetBlock(t),this},n.prototype.SetHiddenFor=function(n){var t=this.GetPropertyBlockByName(n);return t.InterfaceType=UserInterfaceType.Hidden,this.ResetBlock(t),this},n.prototype.ResetBlock=function(n){var t=this._model.Blocks.findIndex(function(t){return t.PropertyName==n.PropertyName});this._model.Blocks[t]=n},n.prototype.GetPropertyBlockByName=function(n){var t=this._model.Blocks.find(function(t){return t.PropertyName==n});if(t==null)throw new Error("Блок не найден по указанному имени "+n);return t},n}(),GenericForm=function(){function n(t){this._genericInterfaces=[];t.FormDrawFactory==null&&n.ThrowError("Фабрика реализаций отрисовки обобщенных форм == null. Проверьте заполнение свойства opts.FormDrawFactory");this._formDrawFactory=t.FormDrawFactory}return n.UnWrapModel=function(n,t){for(var i,r="",u=0;u<n.Blocks.length;u++){i=n.Blocks[u];switch(i.InterfaceType){case UserInterfaceType.TextBox:r+=t.TextBoxFor(i.PropertyName,!0);break;case UserInterfaceType.TextArea:r+=t.TextAreaFor(i.PropertyName,!0);break;case UserInterfaceType.DropDownList:r+=t.DropDownFor(i.PropertyName,i.SelectList,!0);break;case UserInterfaceType.Hidden:r+=t.HiddenFor(i.PropertyName,!0);break;case UserInterfaceType.DatePicker:r+=t.DatePickerFor(i.PropertyName,!0);break;case UserInterfaceType.MultipleDropDownList:r+=t.MultipleDropDownFor(i.PropertyName,i.SelectList,!0);break;default:console.log("Данный блок не реализован",i);throw new Error("Не реализовано");}}return r},n.ThrowError=function(n){alert(n);throw Error(n);},n.prototype.DrawForms=function(){for(var t=document.getElementsByClassName("generic-user-interface"),n=0;n<t.length;n++)this.FindFormAndSave(t[n]);for(n=0;n<this._genericInterfaces.length;n++)this.DrawForm(this._genericInterfaces[n])},n.prototype.FindFormAndSave=function(t){var i=t.getAttribute("data-id"),r=window[i];r!=null&&(t.id==null&&(console.log(t),n.ThrowError("На странице имеются элементы с настройками для генерации обобщенного интерфейса, но у элемента нет идентификатора")),this._genericInterfaces.push({ElementId:t.id,FormDrawKey:"",FormModel:r}),window[i]=null)},n.prototype.DrawForm=function(t){var u=this._formDrawFactory.GetImplementation(t.FormModel,t.FormDrawKey),i=new FormTypeDrawer(u,t.FormModel.TypeDescription),r;i.BeforeFormDrawing();r=document.getElementById(t.ElementId);r==null&&n.ThrowError("Элемент с идентификатором "+t.ElementId+" не найден на странице");r.innerHTML=n.UnWrapModel(t.FormModel,i);i.AfterFormDrawing()},n}(),PropertyFormTypeSearcher=function(){function n(){}return n.FindPropByNameInOneDimension=function(n,t){return n.Properties.find(function(n){return n.PropertyDescription.PropertyName===t})},n.FindPropByName=function(t,i){var r;if(i.includes(".")){var u=i.indexOf("."),f=i.slice(0,u),e=i.slice(u+1,i.length),o=n.FindPropByNameInOneDimension(t,f);return n.FindPropByName(o,e)}if(r=n.FindPropByNameInOneDimension(t,i),r==null)throw new Error("Свойство "+i+" не найдено");return r},n}(),ValueProviderBuilder=function(){function n(){}return n.CreateFromObject=function(n){var i,r,t;n=CrocoAppCore.Application.FormDataUtils.ProccessAllDateTimePropertiesAsString(n);i={Arrays:[],Singles:[]};for(r in n)(t=n[r],Array.isArray(t))||t!==undefined&&i.Singles.push({PropertyName:r,Value:t});return i},n}();